<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>About the timeout and size of data • nomisr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="About the timeout and size of data"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">nomisr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="https://docs.evanodell.com" class="external-link">Docs Home</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/introduction.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://docs.evanodell.com" class="external-link">Documentation Home</a>
    </li>
    <li class="divider">
    <li>
      <a href="https://docs.evanodell.com/hansard" class="external-link">hansard</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/mnis" class="external-link">mnis</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/parlitools" class="external-link">parlitools</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/nomisr" class="external-link">nomisr</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/fixerapi" class="external-link">fixerapi</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/refuge" class="external-link">refuge</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/emisc" class="external-link">emisc</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/nomisr" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://evanodell.com" class="external-link">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>About the timeout and size of data</h1>
    </div>


<p>Hi @cderv and @pegeler, thank you both of you very much for your
helpful comments and suggestions, sorry for not responding more
quickly.</p>
<div class="section level2">
<h2 id="response-to-cderv">Response to @cderv<a class="anchor" aria-label="anchor" href="#response-to-cderv"></a></h2>
<div class="section level4">
<h4 id="list-columns">List-columns<a class="anchor" aria-label="anchor" href="#list-columns"></a></h4>
<p>I find it kind of necessary because you also used list-columns in
tibbles. This is not something easy for some newcomers to handles. Even
for some dplyr users who do not used that a lot, it is not something
easy. Adding some example in the vignettes to show how to retrieve
embedded data.frame inside some tibble’s list column could be a good
idea. To illustrate:</p>
<p>library(nomisr) library(dplyr, warn.conflicts = F) y &lt;-
nomis_data_info(“NM_893_1”) y<span class="math inline"><em>a</em><em>n</em><em>n</em><em>o</em><em>t</em><em>a</em><em>t</em><em>i</em><em>o</em><em>n</em><em>s</em>.<em>a</em><em>n</em><em>n</em><em>o</em><em>t</em><em>a</em><em>t</em><em>i</em><em>o</em><em>n</em></span>annotations.annotation[[1]]
%&gt;% class() #&gt; [1] “data.frame” y %&gt;%
pull(annotations.annotation) %&gt;% class() #&gt; [1] “list” y %&gt;%
pull(annotations.annotation)%&gt;% .[[1]] %&gt;% class() #&gt; [1]
“data.frame” y %&gt;% pull(annotations.annotation) %&gt;%
purrr::pluck(1) %&gt;% class() #&gt; [1] “data.frame” y %&gt;%
pull(annotations.annotation) %&gt;% purrr::map(1) %&gt;% class() #&gt;
[1] “list” y %&gt;% tidyr::unnest(annotations.annotation) %&gt;%
glimpse() #&gt; Observations: 14 #&gt; Variables: 11 #&gt; $ agencyid
<chr> “NOMIS”, “NOMIS”, “NOMIS”… #&gt; $ id <chr> “NM_893_1”,
“NM_893_1”, “… #&gt; $ uri <chr>”Nm-893d1”, “Nm-893d1”, “… #&gt; $
version <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1… #&gt; $
components.primarymeasure.conceptref <chr>”OBS_VALUE”, “OBS_VALUE”,…
#&gt; $ components.timedimension.codelist <chr> “CL_893_1_TIME”,
“CL_893_… #&gt; $ components.timedimension.conceptref <chr>”TIME”,
“TIME”, “TIME”, “… #&gt; $ name.value <chr>”LC4408EW - Tenure by num…
#&gt; $ name.lang <chr> “en”, “en”, “en”, “en”, “… #&gt; $
annotationtext <chr>”Current (being actively … #&gt; $ annotationtitle
<chr> “Status”, “Keywords”, “Un…</chr></chr></chr></chr></chr></chr></chr></dbl></chr></chr></chr></p>
<p><strong>Response:</strong> I’ve added a similar example to the
vignette, which is similar enough to your example that I feel I should
cite you as a contributor if that is okay.</p>
<p>Following are my review comments, for improvement: #### About
Community Guidelines</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>There is no contribution guidelines <span class="cf">in</span> the README or other CONTRIBUTING.md.</span></code></pre></div>
<p><strong>Response:</strong> Added a CONTRIBUTING.md in <a href="https://github.com/evanodell/nomisr/commit/e4bbb0229709a861b1ef2141e9ecf6da6ff8fc10" class="external-link uri">https://github.com/evanodell/nomisr/commit/e4bbb0229709a861b1ef2141e9ecf6da6ff8fc10</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DESCRIPTION needs some improvement <span class="sc">:</span> no need to use Author and Maintainer fields <span class="cf">if</span> you are using Authors<span class="sc">@</span>R. You can just use the latest. You can find some good example <span class="cf">in</span> R package book.</span></code></pre></div>
<p><strong>Response:</strong> Now only using <a href="mailto:Authors@R" class="email">Authors@R</a></p>
</div>
<div class="section level4">
<h4 id="improvement-for-the-packaging-guidelines">Improvement for the packaging guidelines<a class="anchor" aria-label="anchor" href="#improvement-for-the-packaging-guidelines"></a></h4>
<p>see below parts for details</p>
<ul><li>Adding a code of conduct <strong>Response:</strong> I a code of
conduct in <a href="https://github.com/evanodell/nomisr/commit/ede35580b8369aba016b8375f0d6569b58063e9c" class="external-link uri">https://github.com/evanodell/nomisr/commit/ede35580b8369aba016b8375f0d6569b58063e9c</a>
and</li>
<li>Improve README considering it is the first entry point for
discovering NOMIS API</li>
<li>Improve DESCRIPTION for authorship</li>
<li>[minor] follow versionning advice with <em>.</em>.*.9000 for in
development version <strong>Response:</strong> Now following versioning
best practice in development version</li>
<li>[question] I did not find why you need curl package in suggest…
<strong>Response:</strong> For reasons I’m not entirely clear on, the
package was failing on Travis without the curl suggestion, I think due
to a bug in jsonlite.</li>
</ul><p><strong>Response:</strong> For reasons I’m not entirely clear on, the
package was failing on Travis without the curl suggestion, I think due
to a bug in jsonlite.</p>
</div>
<div class="section level4">
<h4 id="readme-improvement">README improvement<a class="anchor" aria-label="anchor" href="#readme-improvement"></a></h4>
<ul><li>I would be more precise on what the NOMIS database is and for who it
is. For example, I found that this submission issue mentioned UK
database but not the README. You help file for the package as pretty
clear description of what it is for. While reviewing, I had a doubt and
went to check on NOMIS. This is why I think the statement of need is not
complete.</li>
<li>It feels like the README could get more examples on what your
package can do. Only one of your functions is shown in the readme.</li>
<li>Put package documentation link in the title of the repo like in the
reprex repo. By the way, you can add a more descriptive description on
your github repo and some tags.</li>
<li>could precise that it uses the tibble format (from the
tidyverse)</li>
</ul><p><strong>Response:</strong> I’ve added more details to the README,
including more details on Nomis itself, a simple example and citation
information.</p>
</div>
<div class="section level4">
<h4 id="vignettes-improvement">Vignettes improvement<a class="anchor" aria-label="anchor" href="#vignettes-improvement"></a></h4>
<ul><li>Vignette was not built when I installed the package with
devtools::install_github. Did not know if this intended behavior or
not.</li>
<li>I tried to build the vignette locally then: it worked.
<ul><li>However, there is a problem on result formatting with the tibble. (I
think because you use result = ‘asis’ in code chunks) and because every
results are not tables (y$annotations.annotation is a list for example.)
so it does not print nicely.
<ul><li>The vignette do not show any code to get the results - I would show
them for someone to learn how to use your function, as examples. (with
echo = TRUE)</li>
<li>The formatting issue is visible on your website too</li>
</ul></li>
</ul></li>
<li>I think the vignette contains necessary information but does not
show enough examples on how to retrieve data in the objects you return.
You mentioned the three list columns with nested data.frame but not show
how correctly extracts the info.</li>
<li>It is pretty clear that you package allows to retrieve a large
amount of data from the NOMIS API. it seems necessary to always use
nomis_data_info, then nomis_codes then nomis_get_data to be sure to not
retrieve to much. The vignette helps you understand that. It could
appears to in your readme, and it could be more clear how to construct a
pipeline for good practice with this API.</li>
</ul><p>These improvement are the reason why I did not check the vignettes
box, even if there is one in the github repo and doc. If you need help
on all this, do not hesitate to ask.</p>
<p><strong>Response:</strong> As mentioned above, I’ve added your
suggestions on exploring list-columns to the vignette, and fixed the
online formatting issues. I’ve changed echo to TRUE to show code</p>
</div>
<div class="section level4">
<h4 id="about-documentation-of-functions-and-examples">About documentation of functions and examples<a class="anchor" aria-label="anchor" href="#about-documentation-of-functions-and-examples"></a></h4>
<ul><li>All functions are well documented.</li>
<li>I encountered some issues running the examples because of a timeout.
I believe this is what you meant in your by “there are some limits to
the amount of data that can be retrieved within a certain period of
time, although those are not published.”. The maybe some improvement to
do on this. (see under)</li>
<li>Is this the reason why you enclosed each example in statement ? am I
not sure on what is the recommendation for API package like this one for
example ? does allow anyone to run examples with something like
example(“nomis_codes”, package = “nomisr”). Idea : Maybe is better here:
does show in help and runs with example, but not run by R CMD check (so
not run by CRAN ?) - see rd vignette from roxygen2</li>
</ul><p><strong>Response:</strong> I’ve changed to </p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>I ran all tests with devtools<span class="sc">::</span><span class="fu">run_examples</span>(<span class="at">run =</span> <span class="cn">FALSE</span>) (<span class="cf">in</span> several time, due to timeout constraint). Everything is working. It works well <span class="cf">for</span> almost all, but your example assign systematically to a <span class="fu">variable</span> (named x or y <span class="sc">-</span> room <span class="cf">for</span> improvement) but never print to show head of results. I feel that is missing.</span></code></pre></div>
<p><strong>Response:</strong> I have changed the names in examples to be
more descriptive of the data they are actually retrieving, and added a
print call so the head is actually dixplayed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>I said <span class="st">"almost all"</span> because there are some very long request <span class="cf">in</span> nomis_get_data. The warning that you put <span class="cf">in</span> Details states that it can be very slow process <span class="cf">if</span> calling significant amount of data. I would emphasize on this, saying this warning <span class="cf">in</span> Description part of the help file. And these example should definitely not be ran.</span></code></pre></div>
<p><strong>Response:</strong> I’ve removed the very long examples from
nomis_get_data - I considered wrapping them in but I think dropping them
is the better option.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>I saw you made a pkgdown website. This is great <span class="sc">!!</span> and nice theme<span class="sc">!</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>I did not find the source code of this website. I would have thought it leaved with the package source code. But no docs folder or gh<span class="sc">-</span>pages. I find it useful to have access <span class="cf">for</span> letting people PR your some typos or other thing and all the site from your package source code. However, you may have good reason.</span></code></pre></div>
<p><strong>Response:</strong> I keep all the source code for my
documentation website in my <a href="https://github.com/evanodell/docs" class="external-link">docs repo</a>. I did this so I
could host on netlify with a custom domain and https encryption which -
at least when I set it up - was not available through github pages. I’m
not sure if that is the best option or not.</p>
</div>
</div>
<div class="section level2">
<h2 id="various-comments-on-the-code">Various comments on the code<a class="anchor" aria-label="anchor" href="#various-comments-on-the-code"></a></h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>[minor] I would put the url of the API <span class="cf">in</span> its own variable. I think it is better practice and more efficient to maintain <span class="cf">in</span> case of change <span class="cf">in</span> the <span class="fu">url</span> (e.g V0<span class="fl">.2</span>). The url is used several time and a change would mean copy pasting. another utils <span class="cf">function</span> could help building the <span class="fu">url</span> (paste0 is used three times), with the same base url def.sdmx.json<span class="er">)</span>. Know that it exists some tools to help build some strings with parameters like glue, and specific one to handle url like urltools or those <span class="cf">in</span> httr. You may not need them here but it is worth knowing.</span></code></pre></div>
<p><strong>Response:</strong> I’ve turned the API URL into its own
variable.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>suppressMessage is used to hide the message of readr<span class="sc">::</span>read_csv. However, the message appears because column types are guessed and not set. It is good practice to set column type <span class="cf">in</span> readr with column_types <span class="ot">=</span> <span class="fu">cols</span>(<span class="sc">&lt;</span>something<span class="sc">&gt;</span>). In an API package like this one, it make even more sense because it could helps be aware of any change <span class="cf">in</span> the <span class="fu">format.</span> (using <span class="fu">stop_for_problems</span>() or just see a message appear) <span class="sc">-</span> see readr vignettes</span></code></pre></div>
<p><strong>Response:</strong> I’ve dropped suppressMessage and used
<code>col_types = readr::cols(.default = readr::col_character())</code>
to make columns characters by default.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>[minor] I don<span class="st">'t know what are the good practice on this one. I just feel that you have a dplyr dependency in import for three functions bind_rows, case_when and if_else than can be easily replace with rbind or if.else. I feel that, if the former are very useful interactively in an analysis, using them in a package can be unnecessary dependency to a "big" package that can cause you some effort later on if anything change in dplyr. More of a personal point of view on this one.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">However, it relates on how you are build your query url</span></span></code></pre></div>
<p>query &lt;- dplyr::if_else(keywords==FALSE,
paste0(“/def.sdmx.json?search=<em>”, search, ”</em>”),
paste0(“/def.sdmx.json?search=keywords-”, search, “*“)</p>
<p>could be rewritten without dplyr::if_else</p>
<p>base_query &lt;- “/def.sdmx.json?search=” if (keyword) { keyword_term
&lt;- “keywords-”) } else { keyword_term &lt;- “<em>” } # or
keyword_term &lt;- if.else(keyword, ”keywords-”, ”</em>”) query &lt;-
paste0(base_query, key_word_term, search, “*“)</p>
<p>It would suppres a non essential dependency.</p>
<p><strong>Response:</strong> I’ve dropped the use of case_when and
if_else in favour the the style you described above. bind_rows is used
to combine together a single tibble with a list of one or more tibbles,
and using rbind in place of bind_rows would require an extra step. If
there are changes to bind_rows in the future it is only in one location
so should be easy to adjust for.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>The style <span class="cf">in</span> code could be improve <span class="cf">in</span> some places. You can follow some style guide to help you.</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>like the one <span class="cf">in</span> ROpensci Guidelines linking to Advanced R or more recent the one used <span class="cf">in</span> the tidyverse styleguide. They even build some tools to help like styler and lintr. Example of improvement<span class="sc">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    put spaces after foror <span class="cf">if</span> and also around <span class="ot">=</span>, <span class="sc">==</span>, <span class="sc">+</span>, <span class="sc">&gt;</span>, ...</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    indentation of <span class="fu">code</span> (<span class="cf">in</span> RStudio CTRL<span class="sc">+</span>i i useful). <span class="cf">for</span> example <span class="cf">in</span> <span class="cf">if</span> () { } <span class="cf">else</span> { }, lines of code that are inside brackets should be indented.</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    use {} with <span class="cf">if</span> when it does not fit on one line</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    More importantly, be consistent <span class="cf">in</span> all your script with the guideline you choose.</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>Know that when you want to stop on a condition, there is also stopifnot. For user experience, you can also return clearer error sometimes with <span class="fu">stop</span>(<span class="st">"API request did not return any results"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>) to not show the call <span class="cf">for</span> example.</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>A good practice is also to use meaningful name inside your internal code, even <span class="cf">for</span> temporary variable. There are a lot of x, a, q, ... This will improve readability and the ease <span class="cf">for</span> others to collaborate on your <span class="fu">code</span> (including future you)</span></code></pre></div>
<p><strong>Response:</strong> I’ve added <code>call. = FALSE</code> to
the various stop messages.</p>
<p><strong>Response:</strong> I’ve gone through the code and changed
temporary variable names to be more meaningful, and formatted the code
to improve indentation, spaces around if and for operators, ==, etc.</p>
</div>
<div id="about-the-timeout-and-size-of-data" class="section level1">

<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>If session is <span class="fu">interactive</span>(), it may be a good idea to warn clearly and even ask <span class="cf">if</span> we want to continue when lots of data are being requested. I find myself playing with the example trying to retrieve <span class="dv">208888</span> of your pages</span></code></pre></div>
<p>Retrieving additional pages 1 of 208888 Retrieving additional pages 2
of 208888</p>
<p>I don’t know if some other API packages are doing something to help
user or if it is all the user responsibility to know what is he doing.
(users will surely be already NOMIS data users).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>As another improvement, I think you should try to create custom error message <span class="cf">for</span> the timeout issue as you know it is an issue that will impact user experience but cannot really prevent. I encountered<span class="sc">:</span></span></code></pre></div>
<p>a &lt;- nomis_codes(“NM_1_1”) # Error in open.connection(con, “rb”) :
# Timeout was reached: Resolving timed out after 10000 milliseconds</p>
<p>You could use some tryCatch mechanism (some useful info in Advanced
R).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>[thoughts] You may need more control on the request mechanism to deal with timeout. First, it seems <span class="cf">for</span> the website one need to contact NOMIS help<span class="sc">-</span>desk to know more about limitation. Then , your are relying on readr connection mechanism, and may need to use httr, crul or curl to better handle request to API with the specificity of NOMIS</span></code></pre></div>
<p><strong>Response:</strong> I’ve used tryCatch to hopefully provide
more useful information in the case of time outs. I’ve also written, but
not implemented, a warning and yes/no option in interactive sesssions
with requests over 350,000 cells which are likely to cause rate limiting
issues.</p>
<p>About SMDX format on NOMIS</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Do you know about the rsdmx package ? it is on github and CRAN, there is WIKI. I did not find NOMIS <span class="cf">in</span> their listing, so I did not know <span class="cf">if</span> it works <span class="cf">for</span> you and how it could overlap with your package.</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rsdmx is definitely more a generic package than yours. I just wanted to point it to you <span class="cf">in</span> case you did not know.</span></code></pre></div>
<p><strong>Response:</strong> I was not aware of it, but it is something
I should explore for the future, thank you for pointing me towards
it.</p>
<div class="section level2">
<h2 id="response-to-pegeler">Response to pegeler<a class="anchor" aria-label="anchor" href="#response-to-pegeler"></a></h2>
<p>Package Review for nomisr</p>
<p>Onboarding submission: ropensci/onboarding#190</p>
<p>Please check off boxes as applicable, and elaborate in comments
below. Your review is not limited to these topics, as described in the
reviewer guide</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>As the reviewer I confirm that there are no conflicts of interest <span class="cf">for</span> me to review this <span class="fu">work</span> (If you are unsure whether you are <span class="cf">in</span> conflict, please speak to your editor before starting your review).</span></code></pre></div>
<p>Documentation</p>
<p>The package includes all the following forms of documentation:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>A statement of need clearly stating problems the software is designed to solve and its target audience <span class="cf">in</span> README</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Installation instructions<span class="sc">:</span> <span class="cf">for</span> the development version of package and any non<span class="sc">-</span>standard dependencies <span class="cf">in</span> README</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Vignette</span>(s) demonstrating major functionality that runs successfully locally</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>Function Documentation<span class="sc">:</span> <span class="cf">for</span> all exported functions <span class="cf">in</span> R help</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>Examples <span class="cf">for</span> all exported functions <span class="cf">in</span> R Help that run successfully locally</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>Community guidelines including contribution guidelines <span class="cf">in</span> the README or CONTRIBUTING, and DESCRIPTION with URL, BugReports and <span class="fu">Maintainer</span> (which may be autogenerated via Authors<span class="sc">@</span>R).</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>For packages co<span class="sc">-</span>submitting to JOSS</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    The package has an obvious research application according to JOSS<span class="st">'s definition</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="st">The package contains a paper.md matching JOSS'</span>s requirements with<span class="sc">:</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    A short summary describing the high<span class="sc">-</span>level functionality of the software</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    Authors<span class="sc">:</span> A list of authors with their affiliations</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    A statement of need clearly stating problems the software is designed to solve and its target audience.</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    References<span class="sc">:</span> with DOIs <span class="cf">for</span> all those that have <span class="fu">one</span> (e.g. papers, datasets, software).</span></code></pre></div>
<p>Functionality</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>Installation<span class="sc">:</span> Installation succeeds as documented.</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Functionality<span class="sc">:</span> Any functional claims of the software been confirmed.</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>Performance<span class="sc">:</span> Any performance claims of the software been confirmed.</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>Automated tests<span class="sc">:</span> Unit tests cover essential functions of the package</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>and a reasonable range of inputs and conditions. All tests pass on the local machine.</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>Packaging guidelines<span class="sc">:</span> The package conforms to the rOpenSci packaging guidelines</span></code></pre></div>
<p>Final approval (post-review)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>The author has responded to my review and made changes to my satisfaction. I recommend approving this package.</span></code></pre></div>
<p>Estimated hours spent reviewing: 10 Review Comments</p>
<p>Excellent work! This is a fine example of the level of quality and
professionalism that I have come to expect from rOpenSci contributions.
This package is a great addition to the complement of R functionality
and provides a facile portal to a useful data source.</p>
<p>Many of the comments that I had have been addressed as a result of
@cderv’s prompt and thorough review. In addition, development has
continued to be very active over the past few weeks! Issues are fixed as
quickly as I find them! Below are a few more comments that I would like
to add. Basic Package Structure Overview README.md</p>
<p>The README.md does not contain citation information, per rOpenSci
packaging guide. I am not sure how necessary that is since there is a
CITATION file in the inst/ directory, however, it should be an easy
add.</p>
<p>I would concur with @cderv in suggesting additional usage examples.
DESCRIPTION</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>The DESCRIPTION file does not currently specify a minimum version of R. I would</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>recommend doing so. A minor release is preferred over a patch release, e.g.</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Depends<span class="sc">:</span> <span class="fu">R</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">4.0</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>is better than</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>Depends<span class="sc">:</span> <span class="fu">R</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">4.1</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>I am not seeing where curl is used even though it is <span class="cf">in</span> the Suggests list.</span></code></pre></div>
<p><strong>Response:</strong> I’ve added a minimum version of R (&gt;=
3.4.0) to the DESCRIPTION.</p>
<p><strong>Response:</strong> Not including curl was causing errors with
jsonlite on travis - I’m not sure why, as jsonlite is supposed to import
curl itself.</p>
<p>CITATION</p>
<blockquote>
<p>The CITATION file uses meta$Date to dynamically fill in date for the
citation. However, the Date entry was removed from the DESCRIPTION file
per gp suggestion so the date is NULL.</p>
</blockquote>
<blockquote>
<p>Since it is considered good practice to omit the Date entry because
it may be prone to falling out of date, it seems that hard-coding the
date in the citation would be silly. I briefly considered the use of a
different field to dynamically update the citation date, such as
Date/Publication or Packaged. However, those will only work for users
who are downloading from a CRAN repos. Therefore I’m a little bit at a
loss as to what the most elegant solution might be. I might suggest
breaking with good practice here and adding the Date field back in since
there is a reason to do so. Suggestions are welcome.</p>
</blockquote>
<p>The CITATION file should also end in a newline character :)</p>
<p><strong>Response:</strong> I’ve hardcoded 2018 into the CITATION
file, which I think is the easiest solution, as its the year the package
was first released, although I’m open to other suggestions as well.</p>
<p>Documentation</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>The man page <span class="cf">for</span> the package is named nmisr, not nomisr. This appears to be a typo.</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>seealso can link to the other package functions using \link{}.</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>It appears that some descriptions may be intended to be multi<span class="sc">-</span>paragraph. Without explicitly</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>using the <span class="sc">@</span>description and <span class="sc">@</span>details tags, the third code block is assumed to be the <span class="st">'details'</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>block by default. Therefore, using explicit roxygen tags might be helpful here.</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>Nomis data comes packaged <span class="cf">in</span> very complex data structures. Please don<span class="st">'t be afraid of '</span>over<span class="sc">-</span>explaining<span class="st">'.</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">The more information in the documentation and vignettes, the better for the user, especially if they do</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">not have prior experience with Nomis data.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">'</span>Nomis<span class="st">' in the title for nomis_search() should be capitalized to be consistent with the rest of the package.</span></span></code></pre></div>
<p><strong>Response:</strong> I’ve expanded the documentation and used
roxygen tags to improve organisation. I’ve also added an expanded
explanation to the package vignette.</p>
<p>Examples</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>The example <span class="cf">for</span> nomis_get_data failed due to lack of data. I recommend finding a specific</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>date range that will return results and then hard<span class="sc">-</span>code that into the example.</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Athough \donttest{} used to be perfect <span class="cf">for</span> API packages because it would not be run by</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>R CMD check but would be run by <span class="fu">example</span>() and would be included <span class="cf">in</span> the man page, it appears</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>that the functionality has changed.</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>Now, according to Hadley<span class="st">'s book, it appears that code enclosed</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">in \donttest{} is indeed checked (though I have yet to confirm). Therefore,</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="st">for long-running API calls, it might make sense to change back to \dontrun{} if you are</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="st">concerned about time-out. I recall</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">reading some best practice advice on CRAN'</span>s website at some point, but cannot find the reference</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>anymore.</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>The examples often show multiple ways to use the <span class="cf">function</span>, which is excellent. However,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>it might be a nice enhancement to add a little extra code to glimpse the data <span class="cf">for</span> the users to get</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>a better feel <span class="cf">for</span> what they are getting out of the API call. This is especially helpful since</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>the data that is returned can differ greatly depending on what args are passed.</span></code></pre></div>
<p><strong>Response:</strong> I’ve added glimpsing to the examples in
different functions.</p>
<p>Vignettes</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>I like the <span class="cf">switch</span> to echo <span class="ot">=</span> <span class="cn">TRUE</span> <span class="cf">for</span> vignette code chunks. This is the user<span class="st">'s opportunity</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="st">to see the code in action for the first time. Including the code used to generate the results can</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="st">aid in understanding and readability.</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="st">Vignettes are not currently built. This is not a big deal. However, it would</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="st">be a convenience for those installing from GitHub or local repos. This is especially true since</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="st">the API calls can cause vignettes to take a long time to build. (Currently I cannot build vignettes</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="st">because I keep getting hung up).</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="st">The addition of the theme and TOC is a nice touch.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="st">It looks like the vignette might still be a little incomplete. I see that the final paragraph of</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="st">Querying data variables is not finished.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="st">It'</span>s unnecessary to hard<span class="sc">-</span>code the results <span class="cf">in</span> code chunks. The results will be output when the vignette is knit.</span></code></pre></div>
<p><strong>Response:</strong> I’ve now pre-built the vignette.</p>
<p>Functionality</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nomis_search</span>()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    [suggestion] Currently, users can either search based on generic search terms or search <span class="cf">for</span> specific keywords.</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    Looking at the API docs, I think there is an opportunity to improve functionality by taking advantage</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    of some of the other search <span class="fu">categories</span> (e.g., name, description, content type, units). This would</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    be doubly useful since content type and units are not searched when performing a generic search.</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    [suggestion] Rather than automatically inserting <span class="fu">wildcards</span> (<span class="sc">*</span>), I would recommend informing the user of the wildcard</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    character so that they can have finer control over how wildcards are used <span class="cf">in</span> their search.</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    It would be nice to mention <span class="cf">in</span> the documentation that several terms can be searched at once using</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    a comma. Alternatively, the parameter could accept a character vector that could be</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    collapsed with commas.</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    [suggestion] The <span class="cf">function</span> could potentially accept character vectors from each of the <span class="fu">categories</span> (as well as</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    a generic search term field) and then the appropriate search string could be created.</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Response:</strong> I have re-written nomis_search in keeping
with your suggestions. It now accepts five parameters - name,
description, keywords, content_type, units - and can search in any or
all of them at the same time, with or without wildcards. I’ve also added
a nomis_content_type() function to assist in looking up specific content
types, which may be used with nomis_search().</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nomis_codes</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    Generally, it is helpful to mirror the language of the source material when possible.</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    The <span class="fu">nomis_codes</span>() <span class="cf">function</span> accepts a <span class="fu">dimension</span> (concept) and the <span class="cf">function</span> returns codes <span class="cf">for</span> that dimension.</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    Therefore, the argument code might be renamed to dimension or concept, since the</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span> searches <span class="cf">for</span> codes availalbe within a dimension.</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    Related to above, I think the <span class="sc">@</span>title could be more descriptive.</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    [suggestion] The query is currently built using a hierarchal structure. E.g., <span class="sc">/</span>api<span class="sc">/</span>v01<span class="sc">/</span>dataset<span class="sc">/</span><span class="er">&lt;</span>ID<span class="sc">&gt;</span><span class="er">/&lt;</span>DIMENSION<span class="sc">&gt;</span><span class="er">/&lt;</span>CODE<span class="sc">&gt;</span><span class="er">/</span>def.sdmx.json. However,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    I think there is an opportunity to make this query a little more flexible and extensible. Instead of enforcing the hierarchy,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    the funciton could use the GET verb to provide a little more control over how the data is filtered. A user could</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    query on criteria from different dimensions than the one which they are interested <span class="cf">in</span> results from. For example,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    even <span class="cf">if</span> the user is interested <span class="cf">in</span> the <span class="st">'item'</span> dimension, they may want to filter on <span class="st">'geography'</span> and <span class="st">'sex'</span>. Using GET would allow</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> this. As an example<span class="sc">:</span> <span class="er">/</span>api<span class="sc">/</span>v01<span class="sc">/</span>dataset<span class="sc">/</span>NM_1_1<span class="sc">/</span>item.def.sdmx.json?geography<span class="ot">=</span><span class="dv">2038432081</span><span class="sc">&amp;</span>sex<span class="ot">=</span><span class="fl">7.</span> This would also expose the user</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    to options <span class="cf">for</span> specifying times and dates, which cannot otherwise be done. I fully acknowledge that this might be over<span class="sc">-</span>building,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    since this <span class="cf">function</span> only provides a support role and will probably not be used that way.</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    This is a minor concern, but I feel it<span class="st">'s cleaner to specify value if a test function returns TRUE first when using ifelse().</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="st">    The code ifelse(is.null(type), "", paste0("/", type)) reads cleaner than ifelse(is.null(type) == FALSE, paste0("/", type), "") IMO.</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">nomis_data_info()</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="st">    The documentation could be more explicit in telling the user that the data returned by this function is metadata.</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span></code></pre></div>
<p><strong>Response:</strong> I’ve updated the documentation to be more
explicit about what the function actually does, and improved the code
readability. I changed the <code>code</code> parameter to
<code>concept</code>, as you suggested, to be more in keeping with the
syntax used in the original API. I’ve also added a specific
<code>search</code> parameter, and a generic
<code>additional_queries</code> parameter, as used in
<code><a href="reference/nomis_get_data.html">nomis_get_data()</a></code></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>    [suggestion] Relating to the comment above, it may be a little clearer to rename the <span class="cf">function</span> something to the effect of <span class="fu">nomis_get_metadata</span>().</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    This naming scheme is more <span class="cf">in</span> line with the pattern set forth by nomis_get_data naming scheme.</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nomis_get_data</span>()</span></code></pre></div>
<p><strong>Response:</strong> I’ve renamed the nomis_codes() function to
nomis_get_metadata(), which I agree is more descriptive of what the
function actually does. I’ve also added the nomis_overview() function,
which returns a more general overview of all available metadata, without
the flexibility and specificity offered by nomis_get_metadata().</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>    I see that the API documentation states, <span class="st">"you have a 25000 cell limit on the number of data values downloaded in these formats."</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    It appears that the code currently breaks the fetch into multiple steps <span class="cf">if</span> the record count is greater than or equal to 25k records.</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    I am curious <span class="cf">if</span> this might be an oversight. It might be useful to test the edge case where the query returns more than 25k cells but</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    fewer than 25k records to see <span class="cf">if</span> everything still works.</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Response:</strong> The 25k limit refers to the number of
observation values, the documentation is rather confusing on that
point.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>    Including a select parameter may be a good enhancement <span class="cf">for</span> the future. Right now, that can be accomplished with</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    additional_queries but is probably important enough to be standalone. This would allow <span class="cf">for</span> additional documentation</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    and sugar to be added <span class="cf">for</span> it.</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><strong>Response:</strong> I’ve added a select parameter as an
enhancement, as it is straightforward to do and reduces the amount of
information that could possibly need to be included under
additional_queries.</p>
<p>Conclusion</p>
<p>This is a great package that will be valuable to anyone interested in
analysis of this data. Nice work!</p>
<p>I appreciate the opportunity to review this package and hope that my
comments are constructive and useful. This package needs just a few
tweaks (namely getting the examples up and running) and then I will
gladly approve!</p>
</div>
</div>


  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://evanodell.com" class="external-link">Evan Odell</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

